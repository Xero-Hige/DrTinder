PROG = main
MODULE_CFLAGS = -DMG_ENABLE_THREADS
LIBS=/usr/local/lib/librocksdb.a
SSL_LIB=openssl
LIB_DIRECTORIES=-L/usr/local/lib/ -L/usr/lib/x86_64-linux-gnu/ -L../libs/mongoose/ -L../libs/rocksdb/include/rocksdb/ -L../libs/rocksdb/include/rocksdb/utilities/ -L. -lpthread -lrocksdb -lz -lbz2 -lsnappy

SOURCES = $(PROG).cpp ../libs/mongoose/mongoose.c Server.cpp UsersDatabase.cpp MessageHandler.cpp
CFLAGS = -g -W -Wall -std=c++11 -Wno-unused-function $(CFLAGS_EXTRA) $(MODULE_CFLAGS) $(LIB_DIRECTORIES)

all: $(PROG) $(LIBS)
CC = g++

ifeq ($(SSL_LIB),openssl)
CFLAGS += -DMG_ENABLE_SSL -lssl -lcrypto
else ifeq ($(SSL_LIB), krypton)
CFLAGS += -DMG_ENABLE_SSL ../../../krypton/krypton.c
endif

$(PROG): $(SOURCES)
	$(CC) $(SOURCES) $(CFLAGS) -o $@

clean:
	rm -rf *.gc* *.dSYM *.exe *.obj *.o a.out $(PROG)
