<!DOCTYPE html>
<html>
<head>
	<% include ../partials/header.ejs %>
</head>

<body>

	<% include ../partials/nav.ejs %>
	<div class="container">
		<header>
			<h2>Usuarios en Base de Datos</h2> 
			<button id="crear_usuario_pop" class="btn mini red-stripe" data-toggle="modal" 
			data-target="#new_user">Crear Usuario</button>
		</header>                

		<table class="table table-striped table-hover table-users" id="dataBase">
			<thead>
				<tr>
					<% var keys = Object.keys(results[0].user); %>
					<% keys.forEach(function (key){ %>
					<% if ( key == "interests" || key == "location" || key == "photo_profile" ) { %>
					
					<% } else {%>
					<th class = "col-lg-1 col-md-1 col-sm-2 col-xs-3"><%= key %></th>
					<% } %>
					<% }); %>
					<th class = "col-lg-1 col-md-1 col-sm-2 col-xs-3">interests</th>
					<th class = "col-lg-1 col-md-1 col-sm-2 col-xs-3">location</th>
					<th class = "col-lg-1 col-md-1 col-sm-2 col-xs-3">photo</th>

				</tr>
			</thead>
			<tbody>

				<% results.forEach(function(r) { %>
				<% var id = r.user["id"] %>
				<tr id ="<%= id %>">
					<% for (var i = 0; i < keys.length; i++) { %>
					<% var value = r.user[keys[i]]; %>
					<% if ( keys[i] == "interests" || keys[i] == "location" || keys[i] == "photo_profile") { %>
					
					<% } else {%>
					<td class = "col-lg-1 col-md-1 col-sm-2 col-xs-3"><%= value %></td>
					<% } %>
					<% } %>
					<!--cosas especiales, falta la foto-->
					<!--lista de categorias-->
					<% var intereses = r.user["interests"];%>
					<% var intereses_por_categoria = {};%>
					<% intereses.forEach(function(cat){ %>
					<% if (!(cat.category in intereses_por_categoria)){ %>
					<% intereses_por_categoria[cat.category]=[cat.value]; %>
					<% } else { %>
					<% intereses_por_categoria[cat.category].push(cat.value); %>
					<% } %>
					<% }); %>

					<td class = "col-lg-1 col-md-1 col-sm-2 col-xs-3">
						<div class="btn-group"> 
							<button class="btn btn-default dropdown-toggle" type="button" id="drop-int-<%= id %>" data-toggle="dropdown">
								Ver <span class="glyphicon glyphicon-plus"></span>
							</button>

							<ul class="dropdown-menu" aria-labelledby="drop-int-<%= id %>">

								<% for (key in intereses_por_categoria){ %>
								<li class="dropdown-header"><%= key %></li>
								<% intereses_por_categoria[key].forEach(function(val){ %>
								<li><%= val%></li>
								<% }); %>
								<% } %>

							</ul>
						</div>
					</td>
					<% var location = r.user["location"];%>
					<td class = "col-lg-1 col-md-1 col-sm-2 col-xs-3">
						<div class="btn-group"> 
							<button class="btn btn-default dropdown-toggle" type="button" id="drop-loc-<%= id %>" data-toggle="dropdown">
								Ver <span class="glyphicon glyphicon-plus"></span>
							</button>
							<ul class="dropdown-menu" aria-labelledby="drop-loc-<%= id %>">

								<% for (key in location){ %>
								<li class="dropdown-header"><%= key %></li>
								<li><%= location[key] %></li>

								<% } %>
							</ul>
						</div>
					</td>
			
					<% var data = r.user["photo_profile"]; %>
					<td class = "col-lg-1 col-md-1 col-sm-2 col-xs-3">
						<span class="glyphicon glyphicon-search" data-value="<%= data %>"></span>
					</td>
				</tr>
				<% }); %>
			</tbody>
		</table>
	</div>

	<!-- Modal -->
	<div id="new_user" class="modal fade" role="dialog">
		<div class="modal-dialog modal-sm">

			<!-- Modal content-->
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal">&times;</button>
					<h4 class="modal-title">Crear Usuario</h4>
				</div>
				<div class="modal-body">
					<div class = "list-group">
						<% keys.forEach(function (key) { %>
						<!--A GENERALIZAR DESPUES-->
						<% if (key == "interests" ||  key == "location" || key == "photo_profile" || key == "id" ) { %>

						<% } else { %>
						<div class = "list-group-item">
							<div class="input-group">

								<span class="input-group-addon" ><%= key %></span>
								<input type="text" class="form-control" id = "crear_<%= key %>">


							</div>
						</div>
						<% } %>
						
						<% }); %>
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">Crear</button>
				</div>
			</div>

		</div>
	</div>
	<div id="img_user" class="modal fade" role="dialog">
		<div class="modal-dialog modal-sm">

			<!-- Modal content-->
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal">&times;</button>
				</div>
				<div class="modal-body">
					<img id="img_a_buscar" class="img-responsive" />
				</div>
			</div>
		</div>
	</div>
	<!-- Para meter la logica de pedir y dar a la base de datos -->
	<!-- <script type= "text/javascript" src"../resolveQuerys.js"></script>> -->
	<script type="text/javascript" src="scripts/show_img.js"></script>
</body>

</html>
